```{r, echo=FALSE}
HIDDEN_SOLS=FALSE
set.seed(1)

ggplot2::theme_set(ggplot2::theme_gray(base_size=13))
```



# Testing hypotheses {#chap-hyp-test}


<div class="lo">
#### Instructions {-}
  
- In this two-hour lab we will go through worked examples in the first hour, and you will attempt to answer some questions in the second hour.
- The Rmarkdown file for this week is [here](https://uoe-psychology.github.io/uoe_psystats/dapr1/labsheets/week_13_practice.Rmd).


#### Learning outcomes {-}

**LO1.** 

**LO2.** 

#### Reading {-}

</div>



## Recap





## Walkthrough

### Extrasensory perception (ESP)

According to [Wikipedia](https://en.wikipedia.org/wiki/Extrasensory_perception), "__Extrasensory perception__ or __ESP__, also called sixth sense, includes claimed reception of information not gained through the recognized physical senses, but sensed with the mind."


<div class='red'>
#### Question of the day {-}
Is there such a thing as extrasensory perception (ESP), also known as the "sixth sense"?
</div>


A famous test for ESP involves a set of cards, shown in Figure \@ref(fig:zener), known as Zener cards:
```{r zener, echo = FALSE, out.width = '80%', fig.align = 'center', fig.cap="Zener cards (Source: https://en.wikipedia.org/wiki/Extrasensory_perception)"}
knitr::include_graphics('images/zener.png')
```

There are five cards, one for each of the different symbols:

1. circle
2. cross
3. wavy lines
4. square
5. star

Subjects randomly draw a card from these five, and telepathically communicate the chosen card to another subject who then tries to guess the symbol. No visual or auditory clues are allowed.


### Example 1: ESP experimental results {-#example-esp-results}
In an experiment conducted on a class of $n = 98$ students, 25 of them correcly guessed their partner's card. 

This is equivalent to saying that the observed sample proportion of correct guesses is $\hat{p} = 25/98 = 0.26$.

`r msmbstyle::question_begin(header = "&#x25BA; Question")`
Is the sample proportion of correct guesses high enough to provide evidence of ESP?
`r msmbstyle::question_end()`

`r msmbstyle::solution_begin()`
We are not sure yet.

We still have to introduce the statistical framework that allows us to determine either:

- if the observed sample statistic is highly unlikely to happen by chance alone
- if it would be very likely to see such a value by chance alone.

As we will see, this framework is called __hypothesis testing__ and involves using a __statistical test__.
`r msmbstyle::solution_end()`



### Example 2: In-class activity {-#example-in-class}

- Everyone in the class randomly picks one of the five symbols in Figure \@ref(fig:zener)
- Draw the symbol in a bit of paper __without showing it to anyone!__
- Pair up with someone
- Telepathically communicate your symbol to your partner, who has to guess it without any visual or auditory clues
- Switch roles
- Did your partner guess your card correctly?


Keep track of the sample size $n$ of the in-class experiment, and the sample statistic $\hat{p}$.
We will use these two values later on to see if we have evidence of ESP in this class.



### The random chance model

`r msmbstyle::question_begin()`
If there was no such thing as ESP, what proportion of guesses do you expect to be correct?
`r msmbstyle::question_end()`


`r msmbstyle::solution_begin()`
If there is no ESP, because there are five cards, each person has a chance of $1/5 = 0.2$ to correctly guess the symbol.

This is similar to asking: what's the chance of observing a given face of a die? If we had to randomly guess, since there are 6 faces, we have a probability of 1/6. Now, instead of six faces, we only have five, hence the 1/5 chance.
`r msmbstyle::solution_end()`

The random-chance-alone model helps us decide whether the observed proportion could easily happen by randomly guessing the symbol or whether the underlying process is something else, such as having extrasensory perception.

We call this probability the **null hypothesis**, and it represents what we would expect if there was no ESP. In this case, the null hypothesis reflects what would happen by random chance alone: __no effect__ of ESP.

We denote the null hypothesis by:
$$
H_0 : \  p = \frac{1}{5}
$$



### The alternative explanation

The research question of interest, if ESP exists, is captured by the __alternative hypothesis__ which contradicts the null one.
We always put the claim of interest for our research in the alternative hypothesis, rather than the null hypothesis.

The null and the alternative hypotheses are competing claims about the population parameter and we can not have the same value of the parameter included in both the null and the alternative. 

In the ESP example, we would have ESP if the chance of guessing the correct symbol was greater than random guessing:

$$
H_1 : p > \frac{1}{5}
$$




### Statistical test

As we saw in [Week 11](#chap-sampling-distributions), sample statistics vary from sample to sample.

The probability of 1/5 represents the population proportion. Even if the population proportion was really equal to 1/5, not every random sample would have a sample proportion exactly equal to 1/5.

The key question is then: __how do we decide in a principled way if a sample proportion is sufficiently above 1/5 to suggest presence of ESP?__

In [Example 1](#example-esp-results) we obtained a sample proportion of 25/98 = 0.26. Is this sufficiently higher than 1/5 = 0.20 to suggest presence of ESP?


The set of principles that allows us to make an informed claim about the population, under uncertainty, is called **statistical hypothesis testing**.

<div class="def">
#### Statistical test {-}

A ___statistical test___ is a method that uses the data collected on a sample to assess a claim about the population.
</div>



### Understanding statistical evidence

`r msmbstyle::question_begin(header = "&#x25BA; Question")`
If $\hat{p}$ denotes the proportion of correctly guessed symbols in an ESP experiment, which of the following sample proportions provide the strongest evidence for ESP?

a. $\hat{p} = 0$
b. $\hat{p} = 1/5$
c. $\hat{p} = 1/2$
d. $\hat{p} = 3/4$
`r msmbstyle::question_end()`

`r msmbstyle::solution_begin()`
The correct answer is (d) as $\hat{p} = 3/4 = 0.75$ is the highest proportion of correctly guessed symbols.
`r msmbstyle::solution_end()`

This example shows us that we assess a claim about a population parameter by quantifying the statistical evidence that the observed statistic gives against the null hypothesis and in favour of the alternative hypothesis.



### Statistical hypotheses

We perform statistical tests on two competing hypotheses about a population parameter:

- __Null hypothesis__ $H_0$: typically a claim about no effect or difference between groups;
- __Alternative hypothesis__ $H_1$: the claim we seek evidence for.

The null hypothesis is typically a very specific claim about the population parameter, while the alternative hypothesis is a broader statement.

To visually help you identify the null vs the alternative, typically:

- $H_0$ includes an = sign
- $H_1$ includes >, < or =


Putting this together, in the ESP investigation we have two competing hypotheses:

$$
H_0 : \  p = \frac{1}{5} \\
H_1 : \  p > \frac{1}{5}
$$


### Statistical significance

Now that we have defined a framework to assess two competing hypotheses about population parameters, how do we quantify the evidence that the sample data bring in favour of the alternative hypothesis?

We do this by quantifying how unusual it is to obtain a statistic as extreme or more extreme than the observed statistic, if the null hypothesis is true.

<div class="def">
#### Statistical significance {-}

We say that the sample results are ___statistically significant___ if it is unlikely that by random chance alone we obtain a statistic that is as extreme as the observed sample statistic or more extreme (in the direction specified by the alternative hypothesis).
</div>


Recall that:

- $p$ = proportion of correct guesses of the symbol
- $H_0 : \ p = 1/5$ vs $H_1 : \  p > 1/5$



#### Scenario 1: statistically significant results {-}

If results are __statistically significant__:

- The sample proportion $\hat{p}$ of correct guesses is unlikely to occur by random chance alone. Recall that by random chance we mean if ESP does not exist and thus $p = 1/5$.
- The sample data provide evidence that the population proportion of correct guesses is higher than 1/5, meaning that we have evidence of ESP.


#### Scenario 2: not statistically significant results {-}

If results are __not statistically significant__:

- The sample proportion $\hat{p}$ of correct guesses could easily happen by random chance alone. 
Recall that by random chance we mean if ESP does not exist and thus $p = 1/5$.
- The sample data do not provide enough evidence to conclude that $p > 1/5$ or that ESP exists.


### Randomization distribution

In order to measure how unusual a sample statistic is, we need to generate many statistics under the null hypothesis and see what's the proportion of the generated statistics that are as extreme as, or more extreme than, the observed statistic.

For the ESP experiment we can obtain the null distribution following this steps.

Load the required packages:
```{r, message=FALSE}
library(tidyverse)
library(moderndive)
```

Create a tibble with the possible outcome of one play. Either:

- your partner correctly guesses your card (S = success), or 
- your partner dot not correctly guess your card (F = failure)

_**Note:** Make sure the column name in the tibble is `vals` and that it is a factor._
```{r, message=FALSE}
outcomes <- tibble(vals = factor(c('S', 'F')))
outcomes
```

Assign the probabilities of each possible outcome, remembering that the sum of the probabilities must sum to one.

- Probability of success (S) = probability of correctly guessing the symbol: $p = 1/5$ 
- Probability of failure (F) is the complement to one: $1 - p = 1 - 1/5 = 4/5$.

```{r}
prob <- c(1/5, 4/5)
```

Generate 1000 samples of size $n = 98$ from the distribution specified by the null hypothesis (__null distribution__):
```{r, message=FALSE, warning=FALSE}
size <- 98
replace <- TRUE
reps <- 1000

samples <- rep_sample_n(outcomes, size = size, replace = replace, reps = reps, prob = prob)
samples
```

Note again, we have $98 \times 1000 = 98,000$ rows.

We can now compute, for each sample (a sequence of S's and F's) the proportion of successes:

```{r}
sample_props <- samples %>% 
  group_by(replicate) %>%
  summarise(prop = sum(vals == 'S') / n())

sample_props
```

Let us now plot the 1000 sample proportions under the null hypothesis. This plot shows the null distribution, and each dot represents one of the 1000 proportions in the above tibble:
```{r, fig.height=6}
ggplot(sample_props, aes(x = prop)) +
  geom_dotplot(binwidth = 0.002, dotsize = 1, fill = 'white') +
  labs(x = expression(hat(p)))
```

Where does the sample statistic from [Example 1](#example-esp-results) lie in the null distribution? Let's add a vertical line showing the value of the observed $\hat{p} = 0.26$:

```{r, fig.height=6}
ggplot(sample_props, aes(x = prop)) +
  geom_dotplot(binwidth = 0.002, dotsize = 1, fill = 'white') +
  geom_vline(xintercept = 0.26, color = 'red', size = 1) +
  labs(x = expression(hat(p)))
```

---

```{r, fig.height=6}
ggplot(sample_props, aes(x = prop)) +
  geom_histogram(color = 'white', binwidth = 0.02) +
  labs(x = expression(hat(p)))
```


```{r, fig.height=6}
ggplot(sample_props, aes(x = prop, fill = prop >= 0.26)) +
  geom_dotplot(binwidth = 0.01, dotsize = 0.25) +
  labs(x = expression(hat(p)), fill = expression(hat(p) > 0.26))
```

---




## Lab

### Required packages

Before attempting to answer any question, make sure to run the following code chunk, which assumes that you have already installed the packages `tidyverse` and `moderndive`.
If you have not installed them yet, type `install.packages("tidyverse")` and `install.packages("moderndive")` in the R console.

This chunk loads the tidyverse and moderndive packages:
```{r}
library(tidyverse)
library(moderndive)
```


###


