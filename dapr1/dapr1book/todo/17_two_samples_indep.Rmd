```{r, echo=FALSE}
HIDDEN_SOLS=FALSE
TOGGLE=TRUE
set.seed(15732)
ggplot2::theme_set(ggplot2::theme_gray(base_size=13))
```

# Comparing two means (independent samples) {#two-indep-samples}


<div class="lo">
#### Instructions {-}
  
  - In this two-hour lab we will go through worked examples in the first hour, and you will attempt to answer some questions in the second hour.
- The Rmarkdown file for this week is [here](https://uoe-psychology.github.io/uoe_psystats/dapr1/labsheets/week_15_practice.Rmd).


#### Learning outcomes {-}

**LO1.** Understand how to perform a two-sample t-test and interpret the results.

**LO2.** Understand how to calculate a two-sample t-interval and interpret the results.

**LO3.** Being able to check the technical conditions for applying the t-procedures.
</div>


## Recap

Last week you explored how to draw conclusions about population parameters on the basis of sample statistics.
In particular, given a random sample of size $n$ from a population, you tested if the population mean was equal to some hypothesized value.

Let the sample mean be $\bar{x}$. We test if the sample was taken from a population with mean $\mu_0$ by comparing the observed $t$-statistic
<center>
$$
t = \frac{\bar{x} - \mu_0}{s/\sqrt{n}}
$$
</center>
with:

- __for one-sided hypotheses__, the critical value of level $\alpha$ from a $t$-distribution with $n-1$ degrees of freedom
<center>
$$
t^*_\textrm{df} = \texttt{qt(p = 1 - alpha, df = n-1)}
$$
</center>

- __for two-sided hypotheses__, the critical value of level $\frac{\alpha}{2}$ from a $t$-distribution with $n-1$ degrees of freedom
<center>
$$
t^*_\textrm{df} = \texttt{qt(p = 1 - alpha/2, df = n-1)}
$$
</center>

We reject the null hypothesis if the observed $t$-statistic is, __in absolute value__, as extreme or more extreme than the critical value:

<center>
__Reject $H_0$ if__ $|t| \geq t^*_\textrm{df}$
</center>
<br>

The above procedure applies when testing a single parameter (a proportion or a mean) from a single population.

Today you will explore and apply inference procedures for comparing parameters between two populations or treatment groups.


## Key terminology

<div class="def">
#### Units and variables {-}

The individual entities on which data are collected are called __observational units__.

The number of observational units in the study is known as the __sample size__, as is typically denoted by $n$.

A __variable__ is any characteristic that varies from observational unit to observational unit.


#### Categorical and quantitative variables {-}

Variables are either __categorical__ or __quantitative__:

- A __categorical variable__ divides the units into groups, placing each unit into exactly one of two or more categories. 
_Technology typ: In R, a categorical variable should be a `factor`._

- A __quantitative variable__ measures a numerical quantity for each case.
Numerical operations like adding and averaging make sense only for quantitative variables.

A special kind of categorical variable is a __binary variable__, for which only two possible categories exist.

_Note: One simple way to distinguish between categorical and quantitative variables is to ask yourself if it makes sense to take an average of the values._


#### Explanatory and response variables {-}

If we are using one variable to help us understand or predict values of another variable, we call the former the __explanatory variable__ and the latter the __response variable__.


#### Observational studies vs randomized experiments {-}

An __observational study__ is a study in which the researcher does manipulate the value of any variable, but simply observes the values as they naturally	exist.

A __randomized experiment__ is a study in which the researcher determines __at random__ the explanatory variable for each unit, before the response variable is measured.


<!-- #### Long vs wide data format {-} -->

<!-- Data are in **long** format if each column represents a different variable (e.g., year, sex or assigned task). -->

<!-- Data are in **wide** format if each column represents a different group (e.g., task 1 and task 2). -->
</div>


## Walkthrough


### Activity 1: Close friends {-}

In today's in-class activity we will use data from the General Social Survey conducted in the US in 2004.
One of the questions asked to a random sample of adult Americans in the 2004 General Social Survey (GSS) was:

> "From time to time, most people discuss important matters with other people. Looking back over the last six months --- who are the people with whom you discussed matters important to you? Just tell me their first names or initials."

The interviewer was asked to record how many names were mentioned, along with the person's sex.

Suppose you now want to examine whether mean and women differ with regard to the number of names they tend to mention.
For simplicity, we will refer to the people with whom you talk about important personal matters as "close friends".

---

`r msmbstyle::question_begin(header = "&#x25BA; Question 1")`
Identify the observational units in this study.
`r msmbstyle::question_end()`


`r msmbstyle::solution_begin(hidden = HIDDEN_SOLS, toggle = TOGGLE)`
The observational units are the sampled adult Americans taking part in the 2004 General Social Survey (GSS).
`r msmbstyle::solution_end()`

---


`r msmbstyle::question_begin(header = "&#x25BA; Question 2")`
- Identify the recorded variables in this study.
- Classify each variabile either as categorical (also binary) or quantitative.
- Identify each variable's role: explanatory or response.


| Variable's name | Type             | Role             |
|:----------------|:----------------:|:----------------:|
| ?               | ?                | ?                |
| ?               | ?                | ?                |


`r msmbstyle::question_end()`


`r msmbstyle::solution_begin(hidden = HIDDEN_SOLS, toggle = TOGGLE)`
The recorded variables are the sex of the participant and the number of names given by the participant. 
The former is categorical and binary^[**Note**: The extensive and open-source data from this specific survey, which was conducted in the US in the year 2004, only has two observed values in the column sex: female and male. 
As the data recorded by the US officials present only two categories in the column sex, in this data the variable sex is categorical and binary.], while the latter is a numerical value that varies from participant to participant. 
We are interested in how the number of mentioned names tends to vary with the sex of the participant. 
For this reason, sex is the explanatory variable, while number of close friends in the response variable.

| Variable's name         | Type                        | Role             |
|:------------------------|:---------------------------:|:----------------:|
| Sex                     | Categorical and binary      | Explanatory      |
| Number of close friends | Quantitative                | Response         |

`r msmbstyle::solution_end()`


---


`r msmbstyle::question_begin(header = "&#x25BA; Question 3")`
Did the study make use of random assignment, random sampling, both or neither?
`r msmbstyle::question_end()`

`r msmbstyle::solution_begin(hidden = HIDDEN_SOLS, toggle = TOGGLE)`
This study only involved random sampling of the units from the population of adult Americans in 2004.
`r msmbstyle::solution_end()`

---

`r msmbstyle::question_begin(header = "&#x25BA; Question 4")`
Is this an observational study or an experiment? Explain why.
`r msmbstyle::question_end()`

`r msmbstyle::solution_begin(hidden = HIDDEN_SOLS, toggle = TOGGLE)`
This is an observational study as the researchers limited themselves to merely record the observed values that naturally occur.
The researchers did not perform any manipulation of the variables, such as random assignment of the units to groups. If this were the case, we would be analysing data from a randomised experiment.
`r msmbstyle::solution_end()`


---

`r msmbstyle::question_begin(header = "&#x25BA; Question 5")`
State, in words, the null and alternative hypotheses to test whether American men and women tend to differ with regard to the average number of close friends they mention.
`r msmbstyle::question_end()`

`r msmbstyle::solution_begin(hidden = HIDDEN_SOLS, toggle = TOGGLE)`
The null hypothesis is that there is no difference in the average reported number of close friends between females and males.
The alternative hypothesis is that there is a difference in the average reported number of close friends between females and males.
`r msmbstyle::solution_end()`

---


`r msmbstyle::question_begin(header = "&#x25BA; Question 6")`
Define the parameters of interest in this study, and identify the appropriate symbols for them.
`r msmbstyle::question_end()`

`r msmbstyle::solution_begin(hidden = HIDDEN_SOLS, toggle = TOGGLE)`
- $\mu_f$: mean number of close friends reported by females
- $\mu_m$: mean number of close friends reported by males
`r msmbstyle::solution_end()`

---

`r msmbstyle::question_begin(header = "&#x25BA; Question 7")`
State the null and alternative hypotheses in symbols.
`r msmbstyle::question_end()`

`r msmbstyle::solution_begin(hidden = HIDDEN_SOLS, toggle = TOGGLE)`
$$
H_0 : \mu_f = \mu_m      \qquad \textrm{OR} \qquad     H_0 : \mu_f - \mu_m = 0\\
H_1 : \mu_f \neq \mu_m   \qquad \textrm{OR} \qquad     H_1 : \mu_f - \mu_m \neq 0
$$
`r msmbstyle::solution_end()`

---

`r msmbstyle::question_begin(header = "&#x25BA; Question 8")`
Explain why the one-sample t-test is not appropriate to answer the research question of this study.
`r msmbstyle::question_end()`

`r msmbstyle::solution_begin(hidden = HIDDEN_SOLS, toggle = TOGGLE)`
The one-sample t-test introduced in [Week 16](#todo) tests if the population that the observed sample came from has a hypothesized mean.
Here, instead, we want to compare the means of two populations (or, if it were a randomized experiment, between two treatment groups).
`r msmbstyle::solution_end()`


---


The survey data are stored in the file [`close_friends.txt`](https://raw.githubusercontent.com/UoE-Psychology/uoe_psystats/master/dapr1/dapr1book/data/close_friends.txt).


---


`r msmbstyle::question_begin(header = "&#x25BA; Question 9")`
Load the data into R and inspect it. 

Look at:

- the variable names;
- the dimensions of the tibble;
- the format of the data.

Make sure that categorical variables are encoded as factors.
`r msmbstyle::question_end()`

`r msmbstyle::solution_begin(hidden = HIDDEN_SOLS, toggle = TOGGLE)`
```{r, message=FALSE}
library(tidyverse)

gss <- read_tsv('https://edin.ac/2vQrCBi', col_names = TRUE)

# inspect the first six rows
head(gss)

# inspect the number of units and variables
dim(gss)

# encode Sex as factor
gss <- gss %>%
  mutate(Sex = factor(Sex))

# check encoding
head(gss)
```
`r msmbstyle::solution_end()`


<!-- <div class="def"> -->
<!-- #### Long vs wide format {-} -->

<!-- Data are in **long** format if each column represents a different variable (e.g., year, sex or assigned task) and they are in **wide** format if each column represents a different group (e.g., task 1 and task 2). -->
<!-- </div> -->

<!-- `r msmbstyle::question_begin()` -->
<!-- Are the data in wide or long format? -->
<!-- `r msmbstyle::question_end()` -->


<!-- We will now convert the data from wide to long format. -->

<!-- The relevant function is: -->
<!-- ``` -->
<!-- pivot_longer(DATA NAME,  -->
<!--              GROUP COLUMNS,  -->
<!--              names_to = "NAME OF COLUMN REPRESENTING GROUPS",  -->
<!--              values_to = "NAME OF VALUES COLUMN") -->
<!-- ``` -->

<!-- ```{r} -->
<!-- gss_data <- pivot_longer(gss,  -->
<!--                          1:2, -->
<!--                          names_to = 'sex', -->
<!--                          values_to = 'number_close_friends') -->
<!-- head(gss_data) -->

<!-- gss_data <- gss_data %>% -->
<!--   mutate(sex = str_replace(sex, 'CloseFriendsMen', 'male'), -->
<!--          sex = str_replace(sex, 'CloseFriendsWomen', 'female')) -->
<!-- head(gss_data) -->
<!-- ``` -->


---

Before learning a new test procedure, we start by performing an exploratory analysis of the data.

---

`r msmbstyle::question_begin(header = "&#x25BA; Question 10")`
Summarise the survey by showing the counts of the number of close friends by sex.
`r msmbstyle::question_end()`

`r msmbstyle::solution_begin(hidden = HIDDEN_SOLS, toggle = TOGGLE)`
```{r}
counts <- gss %>% 
  group_by(Sex, NumberCloseFriends) %>% 
  summarise(count = n())

counts
```

or

```{r}
addmargins(xtabs(~ Sex + NumberCloseFriends, data = gss), margin = 2)
```
`r msmbstyle::solution_end()`

---

`r msmbstyle::question_begin(header = "&#x25BA; Question 11")`
Is the counts table in wide or long format?
`r msmbstyle::question_end()`

`r msmbstyle::solution_begin(hidden = HIDDEN_SOLS, toggle = TOGGLE)`
The counts table is in long format. We can convert it to a wide format as follows:
```{r}
counts <- counts %>%
  pivot_wider(names_from = Sex, values_from = count, names_prefix = 'count_')

counts
```
`r msmbstyle::solution_end()`

---

`r msmbstyle::question_begin(header = "&#x25BA; Question 12")`
Plot the distribution of the number of reported close friends for males and females.
`r msmbstyle::question_end()`

`r msmbstyle::solution_begin(hidden = HIDDEN_SOLS, toggle = TOGGLE)`
```{r, fig.align='center'}
ggplot(gss, aes(x = NumberCloseFriends, fill = Sex)) +
  geom_histogram(binwidth = 1, color = 'white') +
  facet_grid(cols = vars(Sex))
```
`r msmbstyle::solution_end()`

---

`r msmbstyle::question_begin(header = "&#x25BA; Question 13")`
Compute descriptive summaries of the number of close friends reported for each sex.

Report the sample size, sample mean, sample SD, minimum, median, interquartile range, and maximum for each sex.
`r msmbstyle::question_end()`

```{r}
gss %>%
  group_by(Sex) %>%
  summarise(SampleSize = length(NumberCloseFriends), 
            Mean = mean(NumberCloseFriends),
            SD = sd(NumberCloseFriends),
            Minimum = min(NumberCloseFriends),
            Median = median(NumberCloseFriends),
            IQR = IQR(NumberCloseFriends),
            Maximum = max(NumberCloseFriends))

ggplot(gss, aes(x = Sex, y = NumberCloseFriends, fill = Sex)) +
  geom_boxplot()
```



`r msmbstyle::question_begin(header = "&#x25BA; Question 14")`
Are the computed summaries from the previous question parameters or statistics? Explain why.
`r msmbstyle::question_end()`





`r msmbstyle::question_begin(header = "&#x25BA; Question 15")`
Comment on any differences that you observe in the distribution of the reported number of close friends between males and females.
`r msmbstyle::question_end()`



`r msmbstyle::question_begin(header = "&#x25BA; Question 16")`
Do you think it could be possible to obtain sample means this far apart even if the population means were equal? Explain why.
`r msmbstyle::question_end()`



---

Because of sampling variability, we can not conclude that, because the sample means differ, the means of the two populations must differ too.

We must resort to a principled way to test that, and we have already learned that we use statistical hypothesis testing to test if a sample result (in our case, the observed difference in sample mean number of close friends) is significant in the sense of beingly unlikely to have occurred by chance (from random sampling) alone.

__Estimating the magnitude of the difference in population means.__

How can we estimate the magnitude of the difference in population means? By using a confidence interval for the difference in means!





---


### Example 2

```{r}
rm(list = ls())
library(tidyverse)

soupdata = read_tsv("https://statweb.calpoly.edu/bchance/stat302/data/SoupBowl.txt", )
soupdata

soupdata = soupdata %>%
  mutate(group = factor(group)) %>%
  mutate(group = relevel(group, ref = 'secret'))

soupdata$group

t.test(ounces ~ group, data = soupdata, var.equal=FALSE)

t.test(ounces ~ group, data = soupdata, var.equal=TRUE)
```


---


### Example 1: Does color affect creativity and cognitive tasks? {-}

Researchers [Mehta & Zhu (2009)](#w17-references) reported an interesting study evaluating the effect of color on cognitive tasks and creativity.

The two researchers randomly allocated subjects to either a room with a red or blue background.
All subjects were asked to generate as many creative uses for a brick as they could think of within 1 minute.
The quality of their responses was scored by a panel of judges, leading to the following scores of creativity:

|                 |                                        |
|:----------------|:--------------------------------------:|
| Red background  | $n = 35$, $\bar{x} = 3.39$, $s = 0.97$ |
| Blue background | $n = 36$, $\bar{x} = 3.97$, $s = 0.63$ |

Table: **Creativity scores**



<!-- |                 |                                         | -->
<!-- |:----------------|:---------------------------------------:| -->
<!-- | Red background  | $n = 35$, $\bar{x} = 15.89$, $s = 5.90$ | -->
<!-- | Blue background | $n = 36$, $\bar{x} = 12.31$, $s = 5.48$ | -->

<!-- Table: **Accuracy scores** -->

The researcher's claim is that "blue enhances performance on creative tasks".


We note that

1. the values of the two population standard deviations are not known
2. the two samples are independent
3. the samples are simple random samples
4. satisfied the condition that both samples should have size > 30 or that they come from populations having normal distributions


__Step 1. Convert the claim of interest to two competing hypotheses__

The claim is that "blue enhances performance on creative tasks". 
This can be equivalently stated as: people with a blue background will score on average higher than people with a red background.


$$
H_0 : \mu_R \geq \mu_B \\
H_1 : \mu_R < \mu_B
$$


### Case 1: Independent samples with $\sigma_1$ and $\sigma_2$ known {-#two-indep-samples-case-1}

In this section we deal with the scenario when we are testing hypotheses about the means of two populations, $\mu_1$ and $\mu_2$.
The two available samples, one from each population, are assumed to be independent.
Furthemore, we assume we know the standard deviation of the two populations, $\sigma_1$ and $\sigma_2$.


<div class="red">
#### Requirements {-}

1. Distribution of the population. Either or both:
  + The two samples come from populations which are normally distributed;
  + The two sample sizes are both large: $n_1 > 30$ and $n_2 > 30$.

2. The two samples are _independent._

3. Both samples are _simple random samples._


</div>



## References {#w17-references}

- Garrity, K., & Degelman, D. (1990). Effect of server introduction on restaurant tipping 1. Journal of Applied Social Psychology, 20(2), 168-172.
- Mehta, R., & Zhu, R. J. (2009). Blue or red? Exploring the effect of color on cognitive task performances. Science, 323(5918), 1226-1229.


_Material adapted from:_

Rossman, A. J., & Chance, B. L. (2011). _Workshop statistics: discovery with data._ John Wiley & Sons.
